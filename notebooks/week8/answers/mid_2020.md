---
jupytext:
  cell_metadata_filter: -all
  encoding: '# -*- coding: utf-8 -*-'
  formats: ipynb,md:myst,py:percent
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.12
    jupytext_version: 1.6.0-dev
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

# A301 midterm

-   (12) A satellite orbiting at an altitude of 36000 km observes the
    surface in the $CO_2$ absorption band with a wavelength
    range of 14 μm  $< λ < 16$ μm.

    -   The atmosphere is 20 km thick, and has a density scale height of
        *H*<sub>*ρ*</sub> = 11 km and a surface air density of
        *ρ*<sub>*a**i**r*</sub> = 1.2 . The CO<sub>2</sub> mass
        absorption coefficient is
        k<sub>λ</sub> = 0.15 m<sup>2</sup>/kg at
        λ = 15 μm and its mixing ratio is 4 × 10<sup> − 4</sup>
        kg/kg. Find the

        -   the atmosphere’s vertical optical thickness
            τ<sub>λ</sub> in the CO<sub>2</sub> band

        -   the atmosphere’s transmittance *t* in the CO<sub>2</sub>
            band

        directly beneath the satellite.

    -   If the surface is a blackbody with a temperature of 290 K, and
        the atmosphere has an constant temperature of 270 K, find the

        -   monochromatic radiance observed by the satellite in at 15
            *μ**m*

        -   the brightness temperature of the pixel in Kelvin for that
            radiance

    -   Given a pixel size 4 *k**m*<sup>2</sup>, find:

        -   the field of view in steradians, of the pixel

        -   the flux, in *W*/*m*<sup> − 2</sup> at the satellite between
            $14-16 \mu m$



-   (5) Integrate the Schwartzchild equation
    for constant temperature


-   (3) A cone has a spreading angle of 23 degrees between its center
    and its side. What is its subtended solid angle?

+++

## Draw a nice planck function

```{code-cell} ipython3
import a301_lib
#from sat_lib import radiation
import sys
from sat_lib.radiation import calc_radiance, planck_invert
import matplotlib.pyplot as plt
```

```{code-cell} ipython3
from sat_lib.radiation import sigma

microns=np.linspace(0.1,700,500000)
meters=microns*1.e-6

temp=280.
planck_len=calc_radiance(meters,temp)

fig, ax2 = plt.subplots(1,1,figsize=(6,6))
symbol = [':','-','--',-.,'']
temp = [260,270,280,290,300]
for temp, symb in zip(temp,symbol):
    planck_curve = calc_radiance(meters,temp) 
    l0=ax2.plot(microns,np.pi*planck_len*1.e-6,symb,lw=4)
temp=270.
planck_len=calc_radiance(meters,temp)
l1=ax2.plot(microns,np.pi*planck_len*1.e-6,'-',lw=4)
temp=280.
planck_len=calc_radiance(meters,temp)
l2=ax2.plot(microns,np.pi*planck_len*1.e-6,'--',lw=3)
temp=290.
planck_len=calc_radiance(meters,temp)
l3=ax2.plot(microns,np.pi*planck_len*1.e-6,'-.',lw=4)
temp=300.
planck_len=calc_radiance(meters,temp)
l4=ax2.plot(microns,np.pi*planck_len*1.e-6,':',lw=4)
ax2.set_xlabel(r'wavelength ($\mu m$)')
ax2.set_ylabel(r'Monochromatic blackbody flux $E_{bb\lambda}$ ($W\,m^{-2}\,\mu m^{-1}$)')
ax2.set_title("Blackbody flux vs. wavelength")
# Major ticks every 20, minor ticks every 5
major_ticks = np.arange(0, 31, 5)
minor_ticks = np.arange(0, 31, 1)

ax2.set_xticks(major_ticks)
ax2.set_xticks(minor_ticks, minor=True)
major_ticks = np.arange(0, 36, 5)
minor_ticks = np.arange(0, 36, 1)
ax2.set_yticks(major_ticks)
ax2.set_yticks(minor_ticks, minor=True)

# And a corresponding grid
ax2.grid(which='both')

# Or if you want different settings for the grids:
ax2.grid(which='minor', alpha=0.5)
ax2.grid(which='major', alpha=0.7)
ax2.grid(color='k', linestyle=':', linewidth=1)
ax2.set_xlim(0,30)
#ax2.set_ylim()
legax=ax2.legend(('260 K','270 K','280 K','290 K','300 K'),loc='upper left')
ax2.figure.savefig('a301_planck.pdf')
ax2.figure.savefig('a301_planck.png')
fig.tight_layout()
fig.canvas.draw()
print(f"check to see if the integrated flux is correct")
print(f"stefan boltzman flux: {sigma*temp**4.}")
integlen=np.sum(np.diff(meters)*planck_len[:-1])*np.pi
print(f"integrated flux: {integlen}")
microns=np.array([10.,12.])
meters=microns*1.e-6
planck_len=calc_radiance(meters,temp)
```

```{code-cell} ipython3
import numpy as np
domega=2/36000.**2.
print('domega: ',domega)

H=10000.
k=3.e-2
rmix=6.e-3
tau=k*rmix*H*(1 - np.exp(-))
print("tau: ",tau)
Tr=np.exp(-tau)
print("Tr: ",Tr)

Bsfc=calc_radiance(9.e-6,300.)*1.e-6
Batm=calc_radiance(9.e-6,270.)*1.e-6
print('Bsfc, Batm ',Bsfc,Batm)
TOA=Bsfc*Tr + (1 - Tr)*Batm
print('TOA radiance: ',TOA)
Tb=planck_invert(9.e-6,TOA*1.e6)
print('Tb: ',Tb)
flux=TOA*domega*2.
print("flux: ",flux)

cos35 = np.cos(35*np.pi/180.)
print('cos35: ',cos35)
print('omega: ',2*np.pi*(1. - cos35))
```

Answer all four questions (note weights). Show all your work, using
extra blank pages if needed. Include the attached planck function figure
if used for the calculations.

  - (10) A satellite orbiting at an altitude of 36000 km observes the
    surface in a thermal channel with a wavelength range of
    $8\ \mu m < \lambda < 10\ \mu m$.
    
      - Assuming that the atmosphere has density scale height of
        $H_\rho=10$ km and a surface air density of $\rho_{air}=1$
        and that the absorber has mass absorption coefficient of
        $k_\lambda = 3 \times 10^{-2}\ m^2/kg$ at $\lambda=9\ \mu m$
        and a mixing ratio $6 \times 10^{-3}$ kg/kg, find the vertical
        optical thickness $\tau$ and transmittance of the atmosphere
        directly beneath the satellite

```{code-cell} ipython3
1/15
```

```{code-cell} ipython3
import math as m
Hrho = 11e3
rho_air = 1.2
k_lambda = 0.15
ztop = 20.e3
rmix = 4.e-4
decay = (1 - m.exp(-ztop/Hrho))
tau = Hrho*rho_air*k_lambda*rmix*decay
print(tau)
print(m.exp(-tau))
```

    
      - If the surface is black with a temperature of 290 K, and the
        atmosphere has an average temperature of 270 K, find the
        
          - radiance observed by the satellite in at 9 $\mu m$

```{code-cell} ipython3
Bsfc=calc_radiance(15.e-6,290.)*1.e-6
Batm=calc_radiance(15.e-6,270.)*1.e-6
print('Bsfc, Batm ',Bsfc,Batm)
TOA=Bsfc*Tr + (1 - Tr)*Batm
print('TOA radiance: ',TOA)
Tb=planck_invert(15.e-6,TOA*1.e6)
print('Tb: ',Tb)
print('Esfc, Eatm ',m.pi*Bsfc,m.pi*Batm)
E_TOA=m.pi*(Bsfc*Tr + (1 - Tr)*Batm)
print('TOA flux: ',E_TOA)
```

   
      - Given a pixel size 4 $km^2$, what is the flux, in , reaching
        the satellite in this channel?

```{code-cell} ipython3
microns=np.linspace(14.,16.,5000)
meters=microns*1.e-6
planck_vals=calc_radiance(meters,temp)
integlen=np.sum(np.diff(meters)*planck_len[:-1])
area = 4.
orbit = 36.e3
fov = area/orbit**2.
print(f"integrated radiance: {integlen}")
print(f"fov {fov}")
print(f"flux at satellite {integlen*fov}")
```
