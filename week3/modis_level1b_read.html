
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.3. Reading modis level1b data &#8212; ATSC 301</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://a301_web.eoas.ubc.ca/week3/modis_level1b_read.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Week 4" href="../week4/week4_topics.html" />
    <link rel="prev" title="3.2. Acquiring satellite data" href="satellite.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://a301_web.eoas.ubc.ca/week3/modis_level1b_read.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Reading modis level1b data" />
<meta property="og:description" content="Reading modis level1b data  Background  https://mcst.gsfc.nasa.gov/l1b/software-system-overview  https://modis.gsfc.nasa.gov/about/specifications.php  https://w" />


<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">ATSC 301</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   ATSC 301: Fall 2020
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_topics.html">
   1. Week 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/week2_topics.html">
   2. Week 2
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="week3_topics.html">
   3. Week 3
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="assignment1.html">
     3.1. Assignment 1 – brightness temperatures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="satellite.html">
     3.2. Acquiring satellite data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.3. Reading modis level1b data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/week4_topics.html">
   4. Week 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/week5_topics.html">
   5. Week 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_topics.html">
   6. Week 6
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week7/week7_topics.html">
   7. Week 7
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week8/week8_topics.html">
   8. Week 8
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week9/week9_topics.html">
   9. Week 9
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments.html">
   10. Assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../review.html">
   11. Review/logistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks.html">
   12. List of notebooks
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/week3/modis_level1b_read.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/week3/modis_level1b_read.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phaustin/a301_2020/master?urlpath=tree/notebooks/week3/modis_level1b_read.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://a301_hub.eoas.ubc.ca/hub/user-redirect/git-pull?repo=https://github.com/phaustin/a301_2020&urlpath=tree/a301_2020/notebooks/week3/modis_level1b_read.md&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   3.3.1. Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-all-files-from-the-data-dir-that-end-in-hdf">
   3.3.2. get all files from the data_dir that end in hdf
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-the-dataset-and-print-their-indices">
   3.3.3. Find the dataset and print their indices
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-one-of-the-datasets-number-4-ev-1km-emissive-and-get-its-shape-and-data-type">
   3.3.4. open one of the datasets (number 4, EV_1KM_Emissive) and get its shape and data type
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-the-first-row-of-the-first-channel-and-find-its-numpy-dtype">
   3.3.5. Get the first row of the first channel and find its numpy dtype
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-all-the-rows-and-columns-for-the-first-channel">
   3.3.6. get all the rows and columns for the first channel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-the-attributes-for-ev-1km-emissive">
   3.3.7. Find the attributes for EV_1KM_Emissive
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#print-the-first-1000-characters-of-the-metadata-0-string">
   3.3.8. Print the first 1000 characters of the Metadata.0 string
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#now-plot-the-data-using-imshow">
   3.3.9. Now plot the data using imshow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#find-the-index-for-channel-30">
   3.3.10. find the index for channel 30
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#now-get-the-data-for-channel-30">
   3.3.11. Now get the data for channel 30
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#now-convert-the-raw-counts-to-radiances">
   3.3.12. Now convert the raw counts to radiances
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-channel-30-radiances">
   3.3.13. Plot the Channel 30 radiances
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#write-the-radiances-out-for-safekeeping">
   3.3.14. Write the radiances out for safekeeping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#move-all-of-this-into-a-function">
   3.3.15. move all of this into a function
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="reading-modis-level1b-data">
<span id="modis-level1b"></span><h1><span class="section-number">3.3. </span>Reading modis level1b data<a class="headerlink" href="#reading-modis-level1b-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2><span class="section-number">3.3.1. </span>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>https://mcst.gsfc.nasa.gov/l1b/software-system-overview</p>
<p>https://modis.gsfc.nasa.gov/about/specifications.php</p>
<p>https://www.earthdatascience.org/courses/use-data-open-source-python/hierarchical-data-formats-hdf/intro-to-hdf4/</p>
<p>modis swath:  https://svs.gsfc.nasa.gov/3348</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">a301_lib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">pyhdf.SD</span> <span class="kn">import</span> <span class="n">SD</span>
<span class="kn">from</span> <span class="nn">pyhdf.SD</span> <span class="kn">import</span> <span class="n">SDC</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>******************************
context imported. Front of path:
/home/phil/work
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-all-files-from-the-data-dir-that-end-in-hdf">
<h2><span class="section-number">3.3.2. </span>get all files from the data_dir that end in hdf<a class="headerlink" href="#get-all-files-from-the-data-dir-that-end-in-hdf" title="Permalink to this headline">¶</a></h2>
<p>the <code class="docutils literal notranslate"><span class="pre">PosixPath</span></code> object is the way that python is able to treat all folder paths the same, whether they look like <code class="docutils literal notranslate"><span class="pre">C:\Users\phil</span></code> or <code class="docutils literal notranslate"><span class="pre">/Users/home/phil</span></code></p>
<p>There is only 1 hdf file in <code class="docutils literal notranslate"><span class="pre">sat_data</span></code>, so the cell below returns a list of length 1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a301_lib</span><span class="o">.</span><span class="n">sat_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/phil/work/sat_data
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdf4_dir</span> <span class="o">=</span> <span class="n">a301_lib</span><span class="o">.</span><span class="n">sat_data</span> <span class="o">/</span> <span class="s1">&#39;hdf4_files&#39;</span>
<span class="n">all_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf4_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*MYD02*2105*hdf&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;/home/phil/work/sat_data/hdf4_files/MYD021KM.A2013222.2105.061.2018047235850.hdf&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Now read that file (converting PosixPath into a string since the pyhdf library is
expecting a string).  Use the <code class="docutils literal notranslate"><span class="pre">.info</span></code> method to get the number of datasets and attributes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;reading </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">the_file</span> <span class="o">=</span> <span class="n">SD</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">SDC</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
<span class="n">stars</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">50</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">stars</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;number of datasets, number of attributes</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="n">the_file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stars</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Here is the help file for the info funtion:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="c1">#help(SD.info)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>reading /home/phil/work/sat_data/hdf4_files/MYD021KM.A2013222.2105.061.2018047235850.hdf

**************************************************
number of datasets, number of attributes
=(31, 58)
**************************************************

Here is the help file for the info funtion:
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="find-the-dataset-and-print-their-indices">
<h2><span class="section-number">3.3.3. </span>Find the dataset and print their indices<a class="headerlink" href="#find-the-dataset-and-print-their-indices" title="Permalink to this headline">¶</a></h2>
<p>We know we’ve got 31 datasets in the file – what are their names?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets_dict</span> <span class="o">=</span> <span class="n">the_file</span><span class="o">.</span><span class="n">datasets</span><span class="p">()</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">sds</span><span class="p">)</span>

<span class="c1">#breakpoint()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 Latitude
1 Longitude
2 EV_1KM_RefSB
3 EV_1KM_RefSB_Uncert_Indexes
4 EV_1KM_Emissive
5 EV_1KM_Emissive_Uncert_Indexes
6 EV_250_Aggr1km_RefSB
7 EV_250_Aggr1km_RefSB_Uncert_Indexes
8 EV_250_Aggr1km_RefSB_Samples_Used
9 EV_500_Aggr1km_RefSB
10 EV_500_Aggr1km_RefSB_Uncert_Indexes
11 EV_500_Aggr1km_RefSB_Samples_Used
12 Height
13 SensorZenith
14 SensorAzimuth
15 Range
16 SolarZenith
17 SolarAzimuth
18 gflags
19 EV_Band26
20 EV_Band26_Uncert_Indexes
21 Band_250M
22 Band_500M
23 Band_1KM_RefSB
24 Band_1KM_Emissive
25 Noise in Thermal Detectors
26 Change in relative responses of thermal detectors
27 DC Restore Change for Thermal Bands
28 DC Restore Change for Reflective 250m Bands
29 DC Restore Change for Reflective 500m Bands
30 DC Restore Change for Reflective 1km Bands
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="open-one-of-the-datasets-number-4-ev-1km-emissive-and-get-its-shape-and-data-type">
<h2><span class="section-number">3.3.4. </span>open one of the datasets (number 4, EV_1KM_Emissive) and get its shape and data type<a class="headerlink" href="#open-one-of-the-datasets-number-4-ev-1km-emissive-and-get-its-shape-and-data-type" title="Permalink to this headline">¶</a></h2>
<p>The “Earth View Emissive” dataset contains all the longwave channels, and all the 2030 rows and 1354 columns for each
pixel in each channel</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">longwave_data</span> <span class="o">=</span> <span class="n">the_file</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EV_1KM_Emissive&quot;</span><span class="p">)</span>  <span class="c1"># select sds</span>
<span class="nb">print</span><span class="p">(</span><span class="n">longwave_data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;EV_1KM_Emissive&#39;, 3, [16, 2040, 1354], 23, 8)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-the-first-row-of-the-first-channel-and-find-its-numpy-dtype">
<h2><span class="section-number">3.3.5. </span>Get the first row of the first channel and find its numpy dtype<a class="headerlink" href="#get-the-first-row-of-the-first-channel-and-find-its-numpy-dtype" title="Permalink to this headline">¶</a></h2>
<p>uint16 is “unsigned 16 bit integer”, which is how the modis raw counts are stored.  By using
2 8-bit words (2 bytes) for each measurement they can represent (2**16)-1 = 65535 radiance values.  This means, however that every measurement has to be converted from uin16 to float32 before it
can be used</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_row</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># get sds data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_row</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">data_row</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1354,) uint16
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-all-the-rows-and-columns-for-the-first-channel">
<h2><span class="section-number">3.3.6. </span>get all the rows and columns for the first channel<a class="headerlink" href="#get-all-the-rows-and-columns-for-the-first-channel" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">longwave_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[4799, 4471, 5255, ..., 7359, 7389, 7562],
       [5119, 4523, 5478, ..., 7736, 7781, 7811],
       [5152, 4442, 5809, ..., 7831, 7629, 7674],
       ...,
       [7965, 8175, 8227, ..., 7914, 7413, 7600],
       [7943, 7801, 7831, ..., 7539, 7404, 7223],
       [7926, 7955, 7799, ..., 7209, 7344, 6985]], dtype=uint16)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="find-the-attributes-for-ev-1km-emissive">
<h2><span class="section-number">3.3.7. </span>Find the attributes for EV_1KM_Emissive<a class="headerlink" href="#find-the-attributes-for-ev-1km-emissive" title="Permalink to this headline">¶</a></h2>
<p>In order to make the conversion from int to float, we need to
multiply by a scale factor and subtract an offset.  These are
stored as attributes in the hdf file, and they are different
for each of the 16 channels.  Use <code class="docutils literal notranslate"><span class="pre">pprint</span></code> to pretty-print the big
dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">longwave_data</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_FillValue&#39;: 65535,
 &#39;band_names&#39;: &#39;20,21,22,23,24,25,27,28,29,30,31,32,33,34,35,36&#39;,
 &#39;long_name&#39;: &#39;Earth View 1KM Emissive Bands Scaled Integers&#39;,
 &#39;radiance_offsets&#39;: [2467.264404296875,
                      2480.6005859375,
                      2478.176513671875,
                      2402.468505859375,
                      1077.44482421875,
                      1560.3333740234375,
                      2724.21826171875,
                      2317.48828125,
                      2610.015380859375,
                      1560.333251953125,
                      2035.9332275390625,
                      2119.08447265625,
                      2500.599365234375,
                      2499.093505859375,
                      2500.5205078125,
                      2495.89111328125],
 &#39;radiance_scales&#39;: [6.9307534431573e-05,
                     0.00346690253354609,
                     7.626575097674504e-05,
                     8.990753121906891e-05,
                     3.155614103889093e-05,
                     5.639820665237494e-05,
                     0.00011783196532633156,
                     0.0001924497337313369,
                     0.0005570848588831723,
                     0.0004063234373461455,
                     0.0006508072256110609,
                     0.0005710012628696859,
                     0.0002623370965011418,
                     0.00020087281882297248,
                     0.00017676320567261428,
                     0.00011859492224175483],
 &#39;radiance_units&#39;: &#39;Watts/m^2/micrometer/steradian&#39;,
 &#39;units&#39;: &#39;none&#39;,
 &#39;valid_range&#39;: [0, 32767]}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="print-the-first-1000-characters-of-the-metadata-0-string">
<h2><span class="section-number">3.3.8. </span>Print the first 1000 characters of the Metadata.0 string<a class="headerlink" href="#print-the-first-1000-characters-of-the-metadata-0-string" title="Permalink to this headline">¶</a></h2>
<p>Date, orbit number, etc. are stored in a long string attribute called ‘StructMetadata.0’.
The \t character is a tab stop so the file is easier to read with an editor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">the_file</span><span class="o">.</span><span class="n">attributes</span><span class="p">()[</span><span class="s2">&quot;StructMetadata.0&quot;</span><span class="p">][:</span><span class="mi">1000</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;GROUP=SwathStructure\n&#39;
 &#39;\tGROUP=SWATH_1\n&#39;
 &#39;\t\tSwathName=&quot;MODIS_SWATH_Type_L1B&quot;\n&#39;
 &#39;\t\tGROUP=Dimension\n&#39;
 &#39;\t\t\tOBJECT=Dimension_1\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;Band_250M&quot;\n&#39;
 &#39;\t\t\t\tSize=2\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_1\n&#39;
 &#39;\t\t\tOBJECT=Dimension_2\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;Band_500M&quot;\n&#39;
 &#39;\t\t\t\tSize=5\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_2\n&#39;
 &#39;\t\t\tOBJECT=Dimension_3\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;Band_1KM_RefSB&quot;\n&#39;
 &#39;\t\t\t\tSize=15\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_3\n&#39;
 &#39;\t\t\tOBJECT=Dimension_4\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;Band_1KM_Emissive&quot;\n&#39;
 &#39;\t\t\t\tSize=16\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_4\n&#39;
 &#39;\t\t\tOBJECT=Dimension_5\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;10*nscans&quot;\n&#39;
 &#39;\t\t\t\tSize=2040\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_5\n&#39;
 &#39;\t\t\tOBJECT=Dimension_6\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;Max_EV_frames&quot;\n&#39;
 &#39;\t\t\t\tSize=1354\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_6\n&#39;
 &#39;\t\t\tOBJECT=Dimension_7\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;2*nscans&quot;\n&#39;
 &#39;\t\t\t\tSize=408\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_7\n&#39;
 &#39;\t\t\tOBJECT=Dimension_8\n&#39;
 &#39;\t\t\t\tDimensionName=&quot;1KM_geo_dim&quot;\n&#39;
 &#39;\t\t\t\tSize=271\n&#39;
 &#39;\t\t\tEND_OBJECT=Dimension_8\n&#39;
 &#39;\t\tEND_GROUP=Dimension\n&#39;
 &#39;\t\tGROUP=DimensionMap\n&#39;
 &#39;\t\t\tOBJECT=DimensionMap_1\n&#39;
 &#39;\t\t\t\tGeoDimension=&quot;2*nscans&quot;\n&#39;
 &#39;\t\t\t\tDataDimension=&quot;10*nscans&quot;\n&#39;
 &#39;\t\t\t\tOffset=2\n&#39;
 &#39;\t\t\t\tIncrement=5\n&#39;
 &#39;\t\t\tEND_OBJECT=&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="now-plot-the-data-using-imshow">
<h2><span class="section-number">3.3.9. </span>Now plot the data using imshow<a class="headerlink" href="#now-plot-the-data-using-imshow" title="Permalink to this headline">¶</a></h2>
<p>Start over again and make a plot.  We need to be
able to identify particular bands  – the channel numbers
are stored in the “Band_1KM_Emissive” dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">longwave_bands</span> <span class="o">=</span> <span class="n">the_file</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Band_1KM_Emissive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">longwave_bands</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Band_1KM_Emissive&#39;, 1, 16, 5, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band_nums</span> <span class="o">=</span> <span class="n">longwave_bands</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;here are the modis channels in the emissive dataset </span><span class="se">\n</span><span class="si">{</span><span class="n">band_nums</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>here are the modis channels in the emissive dataset 
[20. 21. 22. 23. 24. 25. 27. 28. 29. 30. 31. 32. 33. 34. 35. 36.]
</pre></div>
</div>
</div>
</div>
<p>Note that only channels 20 to 36 are in the Emissive dataset (see <a class="reference external" href="https://modis.gsfc.nasa.gov/about/specifications.php">the Modis channel listing</a>)</p>
<p>Note that only channels 20 to 36 are in the Emissive dataset (see <a class="reference external" href="https://modis.gsfc.nasa.gov/about/specifications.php">the Modis channel listing</a>)</p>
</div>
<div class="section" id="find-the-index-for-channel-30">
<h2><span class="section-number">3.3.10. </span>find the index for channel 30<a class="headerlink" href="#find-the-index-for-channel-30" title="Permalink to this headline">¶</a></h2>
<p>Count the items in the vector above and convince yourself that channel 30 is index 9, starting from 0</p>
<p>But there’s a better way: use numpy.searchsorted to find the index with the closest value
to 30:</p>
<p>We also need to turn that index (type int64) into a plain python int so it can be used to specify the channel</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ch30_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">band_nums</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;make sure our index datatime in int64: </span><span class="si">{</span><span class="n">ch30_index</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ch30_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ch30_index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;channel 30 is located at index </span><span class="si">{</span><span class="n">ch30_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># ## Read channel 30 at index 9 into a numpy array of type uint16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>make sure our index datatime in int64: int64
channel 30 is located at index 9
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="now-get-the-data-for-channel-30">
<h2><span class="section-number">3.3.11. </span>Now get the data for channel 30<a class="headerlink" href="#now-get-the-data-for-channel-30" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ch30_data</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="p">[</span><span class="n">ch30_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ch30_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ch30_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span class="c1">#breakpoint()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2040, 1354)
uint16
</pre></div>
</div>
</div>
</div>
<p>Plot the channel 30 image</p>
<p>Use <a class="reference external" href="https://matplotlib.org/gallery/color/colorbar_basics.html#sphx-glr-gallery-color-colorbar-basics-py">imshow with a colorbar</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ch30_data</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;uncalibrated counts&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># add a label to the colorbar and flip it around 270 degrees</span>
<span class="c1"># (just my personal preference for labels)</span>
<span class="c1">#</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">cax</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Chan 30 raw counts&quot;</span><span class="p">)</span>
<span class="n">out</span><span class="o">.</span><span class="n">set_verticalalignment</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">out</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">270</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ch30_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2040, 1354)
</pre></div>
</div>
<img alt="../_images/modis_level1b_read_30_1.png" src="../_images/modis_level1b_read_30_1.png" />
</div>
</div>
</div>
<div class="section" id="now-convert-the-raw-counts-to-radiances">
<h2><span class="section-number">3.3.12. </span>Now convert the raw counts to radiances<a class="headerlink" href="#now-convert-the-raw-counts-to-radiances" title="Permalink to this headline">¶</a></h2>
<p>We need to find the right scale and offset for channel 30</p>
<p>To turn the raw counts into pixel radiances, you need to apply equation 5.8 on p. 36 of the
<a class="reference external" href="https://www.dropbox.com/s/ckd3dv4n7nxc9p0/modis_users_guide.pdf?dl=0">modis users guide</a>:</p>
<p><span class="math notranslate nohighlight">\(Radiances = (RawData - offset) \times scale\)</span></p>
<p>We have just read the RawData,  the offset and the scale are stored in two vectors that are attributes of the Emissive dataset.  We’ll make a version of the figure above, but plot Channel 30 radiance (in W/m^2/micron/sr), rather than raw counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scales</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="o">.</span><span class="n">attributes</span><span class="p">()[</span><span class="s2">&quot;radiance_scales&quot;</span><span class="p">]</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="o">.</span><span class="n">attributes</span><span class="p">()[</span><span class="s2">&quot;radiance_offsets&quot;</span><span class="p">]</span>
<span class="n">ch30_scale</span> <span class="o">=</span> <span class="n">scales</span><span class="p">[</span><span class="n">ch30_index</span><span class="p">]</span>
<span class="n">ch30_offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">ch30_index</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scale: </span><span class="si">{</span><span class="n">ch30_scale</span><span class="si">}</span><span class="s2">, offset: </span><span class="si">{</span><span class="n">ch30_offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>scale: 0.0004063234373461455, offset: 1560.333251953125
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ch30_calibrated</span> <span class="o">=</span> <span class="p">(</span><span class="n">ch30_data</span> <span class="o">-</span> <span class="n">ch30_offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">ch30_scale</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-the-channel-30-radiances">
<h2><span class="section-number">3.3.13. </span>Plot the Channel 30 radiances<a class="headerlink" href="#plot-the-channel-30-radiances" title="Permalink to this headline">¶</a></h2>
<p>Do these look right?  How would you tell?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ch30_calibrated</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Channel 30 radiance&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># add a label to the colorbar and flip it around 270 degrees</span>
<span class="c1">#</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">cax</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Chan radiance $(W\,m^{-2}\,\mu m^{-1}\,sr^{-1})$&quot;</span><span class="p">)</span>
<span class="n">out</span><span class="o">.</span><span class="n">set_verticalalignment</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
<span class="n">out</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">270</span><span class="p">)</span>
<span class="n">ch30_calibrated</span><span class="o">.</span><span class="n">shape</span>
<span class="c1">#</span>
<span class="c1"># close the file</span>
<span class="c1">#</span>
<span class="n">the_file</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/modis_level1b_read_36_0.png" src="../_images/modis_level1b_read_36_0.png" />
</div>
</div>
</div>
<div class="section" id="write-the-radiances-out-for-safekeeping">
<h2><span class="section-number">3.3.14. </span>Write the radiances out for safekeeping<a class="headerlink" href="#write-the-radiances-out-for-safekeeping" title="Permalink to this headline">¶</a></h2>
<p>Follow the example here: https://hdfeos.org/software/pyhdf.php</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an HDF file</span>
<span class="n">outname</span> <span class="o">=</span> <span class="s2">&quot;ch30_out.hdf&quot;</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">SD</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="n">SDC</span><span class="o">.</span><span class="n">CREATE</span> <span class="o">|</span> <span class="n">SDC</span><span class="o">.</span><span class="n">WRITE</span> <span class="o">|</span> <span class="n">SDC</span><span class="o">.</span><span class="n">TRUNC</span><span class="p">)</span>

<span class="c1"># Create a dataset</span>
<span class="n">sds</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;ch30&quot;</span><span class="p">,</span> <span class="n">SDC</span><span class="o">.</span><span class="n">FLOAT64</span><span class="p">,</span> <span class="n">ch30_calibrated</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Fill the dataset with a fill value</span>
<span class="n">sds</span><span class="o">.</span><span class="n">setfillvalue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Set dimension names</span>
<span class="n">dim1</span> <span class="o">=</span> <span class="n">sds</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dim1</span><span class="o">.</span><span class="n">setname</span><span class="p">(</span><span class="s2">&quot;row&quot;</span><span class="p">)</span>
<span class="n">dim2</span> <span class="o">=</span> <span class="n">sds</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dim2</span><span class="o">.</span><span class="n">setname</span><span class="p">(</span><span class="s2">&quot;col&quot;</span><span class="p">)</span>

<span class="c1"># Assign an attribute to the dataset</span>
<span class="n">sds</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;W/m^2/micron/sr&quot;</span>

<span class="c1"># Write data</span>
<span class="n">sds</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ch30_calibrated</span>

<span class="c1"># Close the dataset</span>
<span class="n">sds</span><span class="o">.</span><span class="n">endaccess</span><span class="p">()</span>

<span class="c1"># Flush and close the HDF file</span>
<span class="n">sd</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Did this work?  See if the file exists:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdf_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*hdf&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hdf_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PosixPath(&#39;ch30_out.hdf&#39;)]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="move-all-of-this-into-a-function">
<h2><span class="section-number">3.3.15. </span>move all of this into a function<a class="headerlink" href="#move-all-of-this-into-a-function" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;reading </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">the_file</span> <span class="o">=</span> <span class="n">SD</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">SDC</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
<span class="n">the_band</span><span class="o">=</span><span class="mi">30</span>

<span class="k">def</span> <span class="nf">readband</span><span class="p">(</span><span class="n">the_file</span><span class="p">,</span><span class="n">the_band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read and calibrate a MODIS band from an open hdf4 SD dataset</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">       the_file:pyhdf.SD object</span>
<span class="sd">           the dataset open for reading</span>
<span class="sd">       the_band: int</span>
<span class="sd">           band number for MODIS (1-36)</span>
<span class="sd">           </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">       the_chan_calibrated: ndarray</span>
<span class="sd">           the pixel radiances in W/m^2/sr/micron</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">longwave_data</span> <span class="o">=</span> <span class="n">the_file</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EV_1KM_Emissive&quot;</span><span class="p">)</span>  <span class="c1"># select sds</span>
    <span class="n">longwave_bands</span> <span class="o">=</span> <span class="n">the_file</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Band_1KM_Emissive&quot;</span><span class="p">)</span>
    <span class="n">band_nums</span> <span class="o">=</span> <span class="n">longwave_bands</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">thechan_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">band_nums</span><span class="p">,</span> <span class="n">the_band</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">thechan_index</span><span class="p">)</span>
    <span class="n">thechan_data</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="p">[</span><span class="n">thechan_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="o">.</span><span class="n">attributes</span><span class="p">()[</span><span class="s2">&quot;radiance_scales&quot;</span><span class="p">]</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="n">longwave_data</span><span class="o">.</span><span class="n">attributes</span><span class="p">()[</span><span class="s2">&quot;radiance_offsets&quot;</span><span class="p">]</span>
    <span class="n">thechan_scale</span> <span class="o">=</span> <span class="n">scales</span><span class="p">[</span><span class="n">thechan_index</span><span class="p">]</span>
    <span class="n">thechan_offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">thechan_index</span><span class="p">]</span>
    <span class="n">thechan_calibrated</span> <span class="o">=</span> <span class="p">(</span><span class="n">thechan_data</span> <span class="o">-</span> <span class="n">thechan_offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">thechan_scale</span>
    <span class="k">return</span> <span class="n">thechan_calibrated</span>

<span class="n">ch_radiance</span> <span class="o">=</span> <span class="n">readband</span><span class="p">(</span><span class="n">the_file</span><span class="p">,</span><span class="n">the_band</span><span class="p">)</span>
<span class="n">the_file</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ch_radiance</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>reading /home/phil/work/sat_data/hdf4_files/MYD021KM.A2013222.2105.061.2018047235850.hdf
9
</pre></div>
</div>
<img alt="../_images/modis_level1b_read_42_1.png" src="../_images/modis_level1b_read_42_1.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./week3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="satellite.html" title="previous page"><span class="section-number">3.2. </span>Acquiring satellite data</a>
    <a class='right-next' id="next-link" href="../week4/week4_topics.html" title="next page"><span class="section-number">4. </span>Week 4</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Philip Austin<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>