
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12.3. Heating rate profiles &#8212; ATSC 301</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://a301_web.eoas.ubc.ca/week12/heating_rate_profile.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="13. Assignments" href="../assignments.html" />
    <link rel="prev" title="12.2. Stull page 246 – application" href="stull_radar_app.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://a301_web.eoas.ubc.ca/week12/heating_rate_profile.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Heating rate profiles" />
<meta property="og:description" content="Heating rate profiles  In Finding the heating rate of the atmosphere we showed that the heating rate Q_r (K/s) for a particular height in the atmosphere was def" />


<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">ATSC 301</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   ATSC 301: Fall 2020
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_topics.html">
   1. Week 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/week2_topics.html">
   2. Week 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/week3_topics.html">
   3. Week 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/week4_topics.html">
   4. Week 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/week5_topics.html">
   5. Week 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_topics.html">
   6. Week 6
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week7/week7_topics.html">
   7. Week 7
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week8/week8_topics.html">
   8. Week 8
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week9/week9_topics.html">
   9. Week 9
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week10/week10_topics.html">
   10. Week 10
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week11/week11_topics.html">
   11. Week 11
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="week12_topics.html">
   12. Week 12
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../week11/subset_map.html">
     12.1. Finding shapefiles with fiona
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="stull_radar_app.html">
     12.2. Stull page 246 – application
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     12.3. Heating rate profiles
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments.html">
   13. Assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks.html">
   14. List of notebooks
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/week12/heating_rate_profile.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/week12/heating_rate_profile.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phaustin/a301_2020/master?urlpath=tree/notebooks/week12/heating_rate_profile.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://a301_hub.eoas.ubc.ca/hub/user-redirect/git-pull?repo=https://github.com/phaustin/a301_2020&urlpath=tree/a301_2020/notebooks/week12/heating_rate_profile.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integrate-the-atmospheric-pressure-temperature-and-density">
   12.3.1. Integrate the atmospheric pressure, temperature and density
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-we-can-find-the-optical-depth">
   12.3.2. Next we can find the optical depth
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flux-with-height">
   12.3.3. Flux with height
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="heating-rate-profiles">
<span id="heating-rate-profile"></span><h1><span class="section-number">12.3. </span>Heating rate profiles<a class="headerlink" href="#heating-rate-profiles" title="Permalink to this headline">¶</a></h1>
<p>In <a class="reference internal" href="../week11/heating_rate.html#heating-rate"><span class="std std-ref">Finding the heating rate of the atmosphere</span></a> we showed that the heating rate <span class="math notranslate nohighlight">\(Q_r\)</span> (K/s) for a particular height in
the atmosphere was defined by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\rho c_p \Delta z \frac{dT}{dt} &amp;= \Delta E_n\\
Q_r = \frac{dT}{dt} &amp;= \frac{1}{\rho c_p} \frac{\Delta E_n}{\Delta z} = \frac{1}{\rho c_p} \frac{dE_n}{dz}
\end{aligned}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(E_n\)</span> was the net flux integrated over all wavelengths (positive downwards), and <span class="math notranslate nohighlight">\(\Delta E_n\)</span> is
the net downward flux <span class="math notranslate nohighlight">\((E_{ntop} - E_{nbot})\)</span> across a layer of thickness <span class="math notranslate nohighlight">\(\Delta z\)</span>.</p>
<p>In this notebook we use the hydrostatic equation  from <a class="reference internal" href="../week5/hydrostat.html#hydro"><span class="std std-ref">Hydrostatic balance</span></a> and the flux equation
from <a class="reference internal" href="../week6/flux_schwartzchild.html#flux-schwartzchild"><span class="std std-ref">The Schwartzchild equation for flux</span></a> to find dT/dz as a function of height for an atmosphere with
containing an absorbing gas with a mixing ratio of <span class="math notranslate nohighlight">\(r_gas=0.01\)</span> kg/kg and a mass absorption coefficient
averaged across all longwave wavelengths of <span class="math notranslate nohighlight">\(k=0.01\)</span>   <span class="math notranslate nohighlight">\(m^2/kg\)</span>.</p>
<div class="section" id="integrate-the-atmospheric-pressure-temperature-and-density">
<h2><span class="section-number">12.3.1. </span>Integrate the atmospheric pressure, temperature and density<a class="headerlink" href="#integrate-the-atmospheric-pressure-temperature-and-density" title="Permalink to this headline">¶</a></h2>
<p>Recall equation <a class="reference internal" href="../week5/hydrostat.html#hydro"><span class="std std-numref">Section 5.3</span></a>:</p>
<div class="math notranslate nohighlight">
\[
dp = -\rho g dz
\]</div>
<p>for a hydrostatic atmosphere, if we assume that dT/dz is constant with height, we can
build up an atmosphere one level at a time, but starting with know <span class="math notranslate nohighlight">\(p\)</span>, <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(T\)</span> at the
surface and using the values of <span class="math notranslate nohighlight">\(dT/dz\)</span>, <span class="math notranslate nohighlight">\(dp/dz\)</span>  to find <span class="math notranslate nohighlight">\(T\)</span> and <span class="math notranslate nohighlight">\(p\)</span> at the next level.  Once
we have those, we can use the ideal gas law to find the density <span class="math notranslate nohighlight">\(\rho\)</span> and move up.</p>
<p>This is done in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hydrostat</span><span class="p">(</span><span class="n">T_surf</span><span class="p">,</span><span class="n">p_surf</span><span class="p">,</span><span class="n">dT_dz</span><span class="p">,</span><span class="n">delta_z</span><span class="p">,</span><span class="n">num_levels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       build a hydrostatic atmosphere by integrating the hydrostatic equation from the surface,</span>
<span class="sd">       using num_levels of constant thickness delta_z</span>
<span class="sd">       </span>
<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>
<span class="sd">       </span>
<span class="sd">       T_surf: float</span>
<span class="sd">            surface temperature in K</span>
<span class="sd">       p_surf: float</span>
<span class="sd">            surface pressure in Pa</span>
<span class="sd">       dT_dz: ndarray</span>
<span class="sd">             rate of temperature change with height in K/m</span>
<span class="sd">       delta_z: float</span>
<span class="sd">             layer thickness in m</span>
<span class="sd">       num_levels: float</span>
<span class="sd">             number of levels in the atmosphere</span>
<span class="sd">       </span>
<span class="sd">       Returns</span>
<span class="sd">       -------</span>
<span class="sd">       </span>
<span class="sd">       Temp, press, rho, height: tuple of ndarrays of length num_levels</span>
<span class="sd">          where the surface is level 0, and each index i larger than 0</span>
<span class="sd">          is located at the height corresponding to the top of a particular layer,</span>
<span class="sd">          so that values at the top of the atmosphere are given by index</span>
<span class="sd">          numlevels - 1</span>
<span class="sd">       </span>
<span class="sd">          Temp (K) , press (Pa), rho (kg/m^3), height (m) for each layer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Rd</span><span class="o">=</span><span class="mf">287.</span> <span class="c1">#J/kg/K  -- gas constant for dry air</span>
    <span class="n">g</span><span class="o">=</span><span class="mf">9.8</span>  <span class="c1">#m/s^2</span>
    <span class="n">Temp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">num_levels</span><span class="p">])</span>
    <span class="n">press</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">Temp</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">Temp</span><span class="p">)</span>
    <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">Temp</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># level 0 sits directly above the surface, so start</span>
    <span class="c1"># with pressure, temp of air equal to ground temp, press</span>
    <span class="c1"># and get density from equaiton of state</span>
    <span class="c1">#</span>
    <span class="n">press</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">p_surf</span>
    <span class="n">Temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">T_surf</span>
    <span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">p_surf</span><span class="o">/</span><span class="p">(</span><span class="n">Rd</span><span class="o">*</span><span class="n">T_surf</span><span class="p">)</span>
    <span class="n">height</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">num_layers</span><span class="o">=</span><span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1">#now march up the atmosphere a level at a time</span>
    <span class="c1"># finding the values at the top of each layer</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_layers</span><span class="p">):</span>
        <span class="n">delP</span><span class="o">=</span> <span class="o">-</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">delta_z</span>
        <span class="n">height</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">height</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_z</span>
        <span class="n">Temp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dT_dz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">delta_z</span>
        <span class="n">press</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">press</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">delP</span>
        <span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">press</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">Rd</span><span class="o">*</span><span class="n">Temp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Temp</span><span class="p">,</span><span class="n">press</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">height</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="next-we-can-find-the-optical-depth">
<h2><span class="section-number">12.3.2. </span>Next we can find the optical depth<a class="headerlink" href="#next-we-can-find-the-optical-depth" title="Permalink to this headline">¶</a></h2>
<p>If we have the air density <span class="math notranslate nohighlight">\(\rho\)</span>, the mixing ratio <span class="math notranslate nohighlight">\(r_{mix}\)</span> asnd  the absorption coefficient <span class="math notranslate nohighlight">\(k\)</span> from Stull Chapter 2
section 2.3.6 we can find the optical depth in the layer:</p>
<div class="math notranslate nohighlight">
\[
\tau = \rho r_{mix} k \Delta z
\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta z\)</span> is the layer thickness.  That’s done in the next cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_tau</span><span class="p">(</span><span class="n">r_gas</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">height</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>
<span class="sd">       </span>
<span class="sd">       r_gas: float</span>
<span class="sd">           gas mixing ratio in kg/kg</span>
<span class="sd">       k: float</span>
<span class="sd">           mass absorption coefficient in kg/m^2</span>
<span class="sd">       rho: ndarray</span>
<span class="sd">           vector of air densities in kg/m^3 for each layer</span>
<span class="sd">       height: ndarray</span>
<span class="sd">        corresponding level heights in m</span>
<span class="sd">        </span>
<span class="sd">       Returns</span>
<span class="sd">       -------</span>
<span class="sd">       </span>
<span class="sd">          tau: ndarray </span>
<span class="sd">             vertical optical depths of each level, starting from 0 at the surface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tau</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="n">tau</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">num_levels</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="n">num_layers</span><span class="o">=</span><span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_layers</span><span class="p">):</span>
        <span class="n">delta_z</span><span class="o">=</span><span class="n">height</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">height</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">delta_tau</span><span class="o">=</span><span class="n">r_gas</span><span class="o">*</span><span class="n">rho</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">delta_z</span>
        <span class="n">tau</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta_tau</span>
    <span class="k">return</span> <span class="n">tau</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="flux-with-height">
<h2><span class="section-number">12.3.3. </span>Flux with height<a class="headerlink" href="#flux-with-height" title="Permalink to this headline">¶</a></h2>
<p>Note the factor of 1.666 below that multiplies the optical depth in
the transmission – this is the flux diffusivity approximation.  The function below
solves for the upward and downward fluxes one layer at at time by calculating
the transmitted flux arriving from the bottom or the top of each layer, and the
emitted flux that the layer is sending to the next layer above or below using the equation given in
<a class="reference internal" href="../week6/flux_schwartzchild.html#equation-layer-flux">(6.14)</a>. This is the
“two stream approximation” mentioned in <a class="reference internal" href="../week6/flux_schwartzchild.html#two-stream-approx"><span class="std std-ref">The two stream approximation</span></a></p>
<p>Assumption:  layers are thin enough so that it is safe to assume constant values
within each layer</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fluxes</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span><span class="n">Temp</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">T_surf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    given properties at each level return the upward and downward</span>
<span class="sd">    total flux at each level assuming no downward longwave flux at the top</span>
<span class="sd">    of the atmosphere, and a surface flux of sigma*T_surf**4.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    </span>
<span class="sd">    tau, Temp, height:  ndarray of length tot_levels</span>
<span class="sd">        total optical depth (from surface), temperature (K) and height (m)</span>
<span class="sd">        at each level</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    up_flux, down_flux: ndarrays</span>
<span class="sd">       upward and downward flux of each level (W/m^2), all positive</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sigma</span><span class="o">=</span><span class="mf">5.67e-8</span> <span class="c1">#W/m^2/K^4</span>
    <span class="n">up_flux</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
    <span class="n">down_flux</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
    <span class="n">sfc_flux</span><span class="o">=</span><span class="n">sigma</span><span class="o">*</span><span class="n">T_surf</span><span class="o">**</span><span class="mf">4.</span>
    <span class="n">up_flux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">sfc_flux</span>
    <span class="n">tot_levs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">tot_levs</span><span class="p">):</span>
        <span class="n">upper_lev</span><span class="o">=</span><span class="n">index</span>
        <span class="n">lower_lev</span><span class="o">=</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">del_tau</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">upper_lev</span><span class="p">]</span> <span class="o">-</span> <span class="n">tau</span><span class="p">[</span><span class="n">lower_lev</span><span class="p">]</span>
        <span class="n">trans</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">del_tau</span><span class="p">)</span>
        <span class="n">emiss</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">trans</span>
        <span class="n">layer_flux</span><span class="o">=</span><span class="n">sigma</span><span class="o">*</span><span class="n">Temp</span><span class="p">[</span><span class="n">lower_lev</span><span class="p">]</span><span class="o">**</span><span class="mf">4.</span><span class="o">*</span><span class="n">emiss</span>
        <span class="c1">#</span>
        <span class="c1"># find the flux at the next level</span>
        <span class="c1">#</span>
        <span class="n">up_flux</span><span class="p">[</span><span class="n">upper_lev</span><span class="p">]</span><span class="o">=</span><span class="n">trans</span><span class="o">*</span><span class="n">up_flux</span><span class="p">[</span><span class="n">lower_lev</span><span class="p">]</span> <span class="o">+</span> <span class="n">layer_flux</span>
    <span class="c1">#</span>
    <span class="c1"># start at the top of the atmosphere</span>
    <span class="c1"># with zero downwelling flux</span>
    <span class="c1">#</span>
    <span class="n">down_flux</span><span class="p">[</span><span class="n">tot_levs</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="c1">#</span>
    <span class="c1"># go down a level at a time, adding up the fluxes</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">tot_levs</span><span class="p">):</span>
        <span class="n">upper_lev</span><span class="o">=</span><span class="n">tot_levs</span> <span class="o">-</span> <span class="n">index</span>
        <span class="n">lower_lev</span><span class="o">=</span><span class="n">tot_levs</span> <span class="o">-</span> <span class="n">index</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">del_tau</span><span class="o">=</span><span class="n">tau</span><span class="p">[</span><span class="n">upper_lev</span><span class="p">]</span> <span class="o">-</span> <span class="n">tau</span><span class="p">[</span><span class="n">lower_lev</span><span class="p">]</span>
        <span class="n">trans</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.666</span><span class="o">*</span><span class="n">del_tau</span><span class="p">)</span>
        <span class="n">emiss</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">trans</span>
        <span class="n">layer_flux</span><span class="o">=</span><span class="n">sigma</span><span class="o">*</span><span class="n">Temp</span><span class="p">[</span><span class="n">upper_lev</span><span class="p">]</span><span class="o">**</span><span class="mf">4.</span><span class="o">*</span><span class="n">emiss</span>
        <span class="n">down_flux</span><span class="p">[</span><span class="n">lower_lev</span><span class="p">]</span><span class="o">=</span><span class="n">down_flux</span><span class="p">[</span><span class="n">upper_lev</span><span class="p">]</span><span class="o">*</span><span class="n">trans</span> <span class="o">+</span> <span class="n">layer_flux</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">up_flux</span><span class="p">,</span><span class="n">down_flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heating_rate</span><span class="p">(</span><span class="n">net_down</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">rho</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    given the net flux at each level (downward positive) and the</span>
<span class="sd">    height, and density of the atmosphere at each level, return</span>
<span class="sd">    the rate of change of temperature in each layer between two levels</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    </span>
<span class="sd">    net_down: ndarray</span>
<span class="sd">       positive downward net flux (W/m^2) at each level</span>
<span class="sd">       </span>
<span class="sd">    height: ndarray</span>
<span class="sd">       vertical location of each level (m)</span>
<span class="sd">       </span>
<span class="sd">    rho: ndarray</span>
<span class="sd">       density (kg/m^3) at each level</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    dT_dz: ndarray  -- length nlevels -1</span>
<span class="sd">       vector of temperature gradients across each layer (K/m)</span>
<span class="sd">       </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">cpd</span><span class="o">=</span><span class="mf">1004.</span>
    <span class="c1">#</span>
    <span class="c1"># find the flux divergence across the layer</span>
    <span class="c1"># by differencing the levels.  Assume the layer density is constant</span>
    <span class="c1"># and equal to the average of the densities at the top and bottom levels</span>
    <span class="c1">#</span>
    <span class="n">rho_mid</span><span class="o">=</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">rho</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">dEn_dz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">net_down</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
    <span class="n">dT_dz</span><span class="o">=</span><span class="n">dEn_dz</span><span class="o">/</span><span class="p">(</span><span class="n">rho_mid</span><span class="o">*</span><span class="n">cpd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dT_dz</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    find the heating rate (K/km) for a hydrostatic</span>
<span class="sd">    atmosphere with a constant decrease of temperature with heigt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#</span>
    <span class="c1"># use 15000 1 m thick layers from 0 to 15 km</span>
    <span class="c1">#</span>
    <span class="n">r_gas</span><span class="o">=</span><span class="mf">0.01</span>  <span class="c1">#kg/kg</span>
    <span class="n">k</span><span class="o">=</span><span class="mf">0.01</span>  <span class="c1">#m^2/kg</span>
    <span class="n">T_surf</span><span class="o">=</span><span class="mi">300</span> <span class="c1">#K</span>
    <span class="n">p_surf</span><span class="o">=</span><span class="mf">100.e3</span> <span class="c1">#Pa</span>
    <span class="n">delta_z</span><span class="o">=</span><span class="mi">1</span>  <span class="c1">#m</span>
    <span class="n">num_levels</span><span class="o">=</span><span class="mi">15000</span>
    <span class="n">dT_dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">num_levels</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">7.e-3</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="n">Temp</span><span class="p">,</span><span class="n">press</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">hydrostat</span><span class="p">(</span><span class="n">T_surf</span><span class="p">,</span><span class="n">p_surf</span><span class="p">,</span><span class="n">dT_dz</span><span class="p">,</span><span class="n">delta_z</span><span class="p">,</span><span class="n">num_levels</span><span class="p">)</span>
    <span class="n">tau</span><span class="o">=</span><span class="n">find_tau</span><span class="p">(</span><span class="n">r_gas</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">height</span><span class="p">)</span>
    <span class="n">up</span><span class="p">,</span><span class="n">down</span><span class="o">=</span><span class="n">fluxes</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span><span class="n">Temp</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">T_surf</span><span class="p">)</span>
    <span class="n">net_down</span> <span class="o">=</span> <span class="n">down</span> <span class="o">-</span> <span class="n">up</span>
    <span class="n">dT_dt</span><span class="o">=</span><span class="n">heating_rate</span><span class="p">(</span><span class="n">down</span> <span class="o">-</span> <span class="n">up</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">rho</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,(</span><span class="n">axis1</span><span class="p">,</span><span class="n">axis2</span><span class="p">,</span><span class="n">axis3</span><span class="p">)</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up</span><span class="p">,</span><span class="n">height</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;upward flux&#39;</span><span class="p">)</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">down</span><span class="p">,</span><span class="n">height</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;downward flux&#39;</span><span class="p">)</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;upward and downward fluxes&#39;</span><span class="p">)</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;flux $(W\,m^{-2}$&#39;</span><span class="p">)</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;height (km)&#39;</span><span class="p">)</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">axis1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

   
    <span class="n">axis2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">net_down</span><span class="p">,</span><span class="n">height</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">axis2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;net downward flux&#39;</span><span class="p">)</span>
    <span class="n">axis2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;net downward flux $(W\,m^{-2})$&#39;</span><span class="p">)</span>
    <span class="n">axis2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;height (km)&#39;</span><span class="p">)</span>
    <span class="n">axis2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


    <span class="n">dT_dt</span><span class="o">=</span><span class="n">dT_dt</span><span class="o">*</span><span class="mf">3600.</span>
    <span class="n">mid_height</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">height</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">axis3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dT_dt</span><span class="p">,</span><span class="n">mid_height</span><span class="o">*</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">axis3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;heating rate&#39;</span><span class="p">)</span>
    <span class="n">axis3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;heating rate in K/hr&#39;</span><span class="p">)</span>
    <span class="n">axis3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;height (km)&#39;</span><span class="p">)</span>
    <span class="n">axis3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/heating_rate_profile_10_0.png" src="../_images/heating_rate_profile_10_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./week12"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="stull_radar_app.html" title="previous page"><span class="section-number">12.2. </span>Stull page 246 – application</a>
    <a class='right-next' id="next-link" href="../assignments.html" title="next page"><span class="section-number">13. </span>Assignments</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Philip Austin<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>