
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11.5. Adding features to a cartopy map &#8212; ATSC 301</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://a301_web.eoas.ubc.ca/week11/features_demo.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.6. Notes on the Marshall-Palmer distribution and the Z-RR relation" href="marshall_palmer.html" />
    <link rel="prev" title="11.4. Finding the heating rate of the atmosphere" href="heating_rate.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://a301_web.eoas.ubc.ca/week11/features_demo.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Adding features to a cartopy map" />
<meta property="og:description" content="Adding features to a cartopy map  This is an updated version of the first mapping notebook with two changes:  Change the coordinate transformation code from car" />


<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">ATSC 301</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   ATSC 301: Fall 2020
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_topics.html">
   1. Week 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/week2_topics.html">
   2. Week 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/week3_topics.html">
   3. Week 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/week4_topics.html">
   4. Week 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/week5_topics.html">
   5. Week 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_topics.html">
   6. Week 6
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week7/week7_topics.html">
   7. Week 7
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week8/week8_topics.html">
   8. Week 8
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week9/week9_topics.html">
   9. Week 9
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week10/week10_topics.html">
   10. Week 10
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="week11_topics.html">
   11. Week 11
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="final_guide.html">
     11.1. Study guide for final exam
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hires_map.html">
     11.2. Adding a high resolution map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ndvi_fiona.html">
     11.3. Rasterio II: clipping bands 3,4 and 5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="heating_rate.html">
     11.4. Finding the heating rate of the atmosphere
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     11.5. Adding features to a cartopy map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="marshall_palmer.html">
     11.6. Notes on the Marshall-Palmer distribution and the Z-RR relation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="radar.html">
     11.7. Notes on the radar equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../week8/level2_cartopy_resample_sol.html">
     11.8. Assign 5a: Water vapor retrieval solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week12/week12_topics.html">
   12. Week 12
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assignments.html">
   13. Assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks.html">
   14. List of notebooks
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/week11/features_demo.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/week11/features_demo.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phaustin/a301_2020/master?urlpath=tree/notebooks/week11/features_demo.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://a301_hub.eoas.ubc.ca/hub/user-redirect/git-pull?repo=https://github.com/phaustin/a301_2020&urlpath=tree/a301_2020/notebooks/week11/features_demo.md&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-the-coordinates">
   11.5.1. Checking the coordinates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-a-new-set-of-features">
   11.5.2. Adding a new set of features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-the-north-american-rivers-geojson-file">
   11.5.3. Read the North American Rivers geojson file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-rivers-to-the-map">
   11.5.4. Add rivers to the map
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">a301_lib</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="n">pacific</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;US/Pacific&quot;</span><span class="p">)</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pacific</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;written on </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>******************************
context imported. Front of path:
/home/phil/work
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>written on 2020-11-18 07:50:16.325254-08:00
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-features-to-a-cartopy-map">
<span id="feature-demo"></span><h1><span class="section-number">11.5. </span>Adding features to a cartopy map<a class="headerlink" href="#adding-features-to-a-cartopy-map" title="Permalink to this headline">¶</a></h1>
<p>This is an updated version of the <a class="reference external" href="https://a301_web.eoas.ubc.ca/week4/cartopy_mapping_h5.html#geographic-coordinate-systems">first mapping notebook</a> with two
changes:</p>
<ol class="simple">
<li><p>Change the coordinate transformation code from cartopy’s <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/crs/index.html">transform_points</a> to pyproj’s <a class="reference external" href="https://pyproj4.github.io/pyproj/stable/api/transformer.html">Transformer</a></p></li>
<li><p>Add features from a geojson file that maps North American rivers, which I downloaded from <a class="reference external" href="https://github.com/nvkelso/natural-earth-vector/tree/master/geojson">natural earth</a></p></li>
</ol>
<p>Why am I changing the code for CRS transformation from cartopy to pyproj?  Basically because cartopy is planning
to move from its own transformation code to the newer pyproj format, but it’s
<a class="reference external" href="https://github.com/SciTools/cartopy/pull/1023">still in underway</a>.  Eventually, we won’t have to switch between
cartopy’s coordinate objects and pyprojs, but for now, I need to create separate versions for each package:</p>
<ol class="simple">
<li><p>Lambert Azimuthal Equal Area for cartopy: cartopy_laea</p></li>
<li><p>Lambert Azimuthal Equal Area for pyproj:  proj_laea</p></li>
<li><p>Geodetic lat/lon for cartopy: cartopy_latlon (cartopy.crs.PlateCarree())</p></li>
<li><p>Geodetic lat/lon for pyproj:  proj_latlon</p></li>
</ol>
<p>Note the different formats when I print them out below – pyproj is much fancier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="n">cartopy_laea</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertAzimuthalEqualArea</span><span class="p">(</span>
    <span class="n">central_latitude</span><span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=-</span><span class="mi">123</span>
<span class="p">)</span>

<span class="n">proj_laea</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_proj4</span><span class="p">(</span><span class="n">cartopy_laea</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">)</span>
<span class="n">proj_latlon</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_proj4</span><span class="p">(</span><span class="s2">&quot;+proj=latlon&quot;</span><span class="p">)</span>
<span class="n">cartopy_latlon</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cartopy_latlon</span><span class="o">.</span><span class="n">proj4_params</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cartopy_laea</span><span class="o">.</span><span class="n">proj4_params</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proj_latlon</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proj_laea</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proj_latlon</span><span class="o">.</span><span class="n">to_wkt</span><span class="p">()</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cartopy_latlon.proj4_params={&#39;ellps&#39;: &#39;WGS84&#39;, &#39;a&#39;: 57.29577951308232, &#39;proj&#39;: &#39;eqc&#39;, &#39;lon_0&#39;: 0.0}

cartopy_laea.proj4_params={&#39;ellps&#39;: &#39;WGS84&#39;, &#39;proj&#39;: &#39;laea&#39;, &#39;lon_0&#39;: -123, &#39;lat_0&#39;: 45, &#39;x_0&#39;: 0.0, &#39;y_0&#39;: 0.0}

proj_latlon=&lt;Geographic 2D CRS: +proj=latlon +type=crs&gt;
Name: unknown
Axis Info [ellipsoidal]:
- lon[east]: Longitude (degree)
- lat[north]: Latitude (degree)
Area of Use:
- undefined
Datum: World Geodetic System 1984
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich

proj_laea=&lt;Projected CRS: +proj=laea +ellps=WGS84 +lon_0=-123 +lat_0=45 +x_0 ...&gt;
Name: unknown
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- undefined
Coordinate Operation:
- name: unknown
- method: Lambert Azimuthal Equal Area
Datum: Unknown based on WGS84 ellipsoid
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich

proj_latlon.to_wkt()=&#39;GEOGCRS[&quot;unknown&quot;,DATUM[&quot;World Geodetic System 1984&quot;,ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,LENGTHUNIT[&quot;metre&quot;,1]],ID[&quot;EPSG&quot;,6326]],PRIMEM[&quot;Greenwich&quot;,0,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],ID[&quot;EPSG&quot;,8901]],CS[ellipsoidal,2],AXIS[&quot;longitude&quot;,east,ORDER[1],ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,ID[&quot;EPSG&quot;,9122]]],AXIS[&quot;latitude&quot;,north,ORDER[2],ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,ID[&quot;EPSG&quot;,9122]]]]&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="checking-the-coordinates">
<h2><span class="section-number">11.5.1. </span>Checking the coordinates<a class="headerlink" href="#checking-the-coordinates" title="Permalink to this headline">¶</a></h2>
<p>In this cell I set up the bounding box.  As a santity check, I make sure that
the upper left and lower right corner coordinates are in the correct order
(left more negative than right, bottom more negative than top) and that
Vancouver is inside the box.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ul_corner</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">135</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>
<span class="n">lr_corner</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">105</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">proj_latlon</span><span class="p">,</span> <span class="n">proj_laea</span><span class="p">)</span>
<span class="n">laea_x</span><span class="p">,</span> <span class="n">laea_y</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">ul_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lr_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                           <span class="p">[</span><span class="n">ul_corner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">lr_corner</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">ul_corner</span> <span class="o">=</span> <span class="n">laea_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">laea_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lr_corner</span> <span class="o">=</span> <span class="n">laea_x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">laea_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">[</span><span class="n">ul_corner</span><span class="p">,</span><span class="n">lr_corner</span><span class="p">]</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">)</span>
<span class="n">van_lon</span><span class="p">,</span> <span class="n">van_lat</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">123.1207</span><span class="p">,</span> <span class="mf">49.2827</span><span class="p">]</span>
<span class="n">van_x</span><span class="p">,</span> <span class="n">van_y</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">van_lon</span><span class="p">,</span> <span class="n">van_lat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">van_x</span><span class="si">=}</span><span class="s2">,</span><span class="si">{</span><span class="n">van_y</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(-821739.5969291353, 840601.1262209273), (1633899.1460315015, -934714.9460819446)]=
van_x=-8788.6117014886,van_y=475998.894646293
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">cartopy_laea</span><span class="p">})</span>
<span class="c1">#</span>
<span class="c1"># extent order  [xleft, xright, ybot, ytop]</span>
<span class="c1">#</span>
<span class="n">laea_extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">ul_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lr_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lr_corner</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ul_corner</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">laea_extent</span><span class="p">,</span> <span class="n">cartopy_laea</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># the simple lon,lat projection is called &quot;geodetic&quot;</span>
<span class="c1">#</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">van_x</span><span class="p">,</span> <span class="n">van_y</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">GSHHSFeature</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">&quot;coarse&quot;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]));</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;10m&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/features_demo_5_0.png" src="../_images/features_demo_5_0.png" />
</div>
</div>
</div>
<div class="section" id="adding-a-new-set-of-features">
<h2><span class="section-number">11.5.2. </span>Adding a new set of features<a class="headerlink" href="#adding-a-new-set-of-features" title="Permalink to this headline">¶</a></h2>
<p>Here are the shape files I’ve downloaded.  See the Readme_gshhs_wdbII.md for details.  The
“10m” in the file names mean:  1:10 million – i.e. 1 meter on a map is 10 million meters
in the real world, or equivalently, 1 cm on the map is 100 km in the real world.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">openstreetmap_dir</span> <span class="o">=</span> <span class="n">a301_lib</span><span class="o">.</span><span class="n">data_share</span> <span class="o">/</span> <span class="s1">&#39;openstreetmap&#39;</span>
<span class="n">all_shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">openstreetmap_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span>
<span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_shapes</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ubc_coastlines
WDBII_shp
ne_10m_rivers_north_america.geojson
GSHHS_shp
ubc_coastlines_big
Readme_gshhs_wdbII.md
ne_10m_lakes_north_america.geojson
ne_10m_rivers_europe.geojson
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-the-north-american-rivers-geojson-file">
<h2><span class="section-number">11.5.3. </span>Read the North American Rivers geojson file<a class="headerlink" href="#read-the-north-american-rivers-geojson-file" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">map_folder</span> <span class="o">=</span> <span class="n">a301_lib</span><span class="o">.</span><span class="n">data_share</span> <span class="o">/</span> <span class="s1">&#39;openstreetmap&#39;</span>
<span class="n">na_rivers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">map_folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*rivers*north*&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_rivers</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">na_rivers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df_rivers</span><span class="o">.</span><span class="n">crs</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">df_rivers</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">=}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df_rivers.crs=&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich



df_rivers.head()=  featurecla  scalerank  rivernum    dissolve      name name_alt  \
0      River         10     22360  22360River  Colorado     None   
1      River         10     22572  22572River  Cimarron     None   
2      River         10     22519  22519River   Washita     None   
3      River         10     22519  22519River   Washita     None   
4      River         11     22422  22422River   Conecuh     None   

                          note       name_full  min_zoom  strokeweig   uident  \
0  ID is link back to CEC data  Colorado River       6.0        0.30  1987701   
1  ID is link back to CEC data  Cimarron River       6.0        0.25  2154301   
2  ID is link back to CEC data   Washita River       6.0        0.25  1947701   
3  ID is link back to CEC data   Washita River       6.0        0.15  1947701   
4  ID is link back to CEC data   Conecuh River       6.7        0.15  2165001   

   min_label                                           geometry  
0        7.0  LINESTRING (-95.96471 28.60493, -95.97834 28.7...  
1        7.0  LINESTRING (-96.50890 36.13121, -96.68293 36.0...  
2        7.0  LINESTRING (-97.56143 34.84817, -97.51403 34.8...  
3        7.0  LINESTRING (-100.56387 35.70030, -100.52872 35...  
4        7.7  LINESTRING (-85.72590 32.12922, -85.74258 32.0...  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Here is the first row in the dataframe</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rivers</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/features_demo_11_0.svg" src="../_images/features_demo_11_0.svg" /></div>
</div>
</div>
<div class="section" id="add-rivers-to-the-map">
<h2><span class="section-number">11.5.4. </span>Add rivers to the map<a class="headerlink" href="#add-rivers-to-the-map" title="Permalink to this headline">¶</a></h2>
<p>Now put the rivers on the map and redraw.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">df_rivers</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">],</span><span class="n">cartopy_latlon</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/features_demo_13_0.png" src="../_images/features_demo_13_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./week11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="heating_rate.html" title="previous page"><span class="section-number">11.4. </span>Finding the heating rate of the atmosphere</a>
    <a class='right-next' id="next-link" href="marshall_palmer.html" title="next page"><span class="section-number">11.6. </span>Notes on the Marshall-Palmer distribution and the Z-RR relation</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Philip Austin<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>